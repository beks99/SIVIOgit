---
title: "Usage"
author: "Beks"
date: "10/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(kableExtra)
```

```{r}
data = read.csv(file = "~/SIVIOgit/clean_financial_inclusion.csv")
```

# levels of inclusion.

This can be used to compare across the different measures.

```{r}
# province
# gender_inclusion 
# location_inclusion 
# size_inclusion
# age_inclusion
# formality_inclusion
# sector_inclusion

level = c("province")
```

# Usage

## criteria of dimension

```{r include=FALSE}
criteria = c(
  "funds_start_value",
  "funds_ongoing_value",
  "frequency_bank_account_value",
  "number_bank_services_value",
  "successful_bids_value",
  "commercial_loan_apply_value",
  "Number_commercial_loan_application_value",
  "success_loan_commercial_value",
  "service_loan_commercial_value",
  "interest_commercial_value",
  "payback_commercial_value",
  "number_services_other_value",
  "other_formal_loan_value",
  "service_loan_other_value",
  "interest_rate_loan_other_5years_value",
  "payback_loan_other_5years_value",
  "comprehensive_value",
  "staff_value",
  "product_value",
  "frequency_mobile_money_value",
  "loan_mm_value",
  "investments_value"
  )

ncriteria = length(criteria)
```

There are `r ncriteria` criteria

The criteria are `r criteria`


## Characteritics

### funds start

Where generally get funds to start business

Informal vs formal vs both

- Formal (MFI, Bank, Order finance, Rotating and Savings group, Local NGO, Credit Union, Government assiatnce program, International org through a grant, fellow business colleagues)

- Informal (personal savings, loan sharks, loaccly based family and friends, remittances from family or friends outside Zimbabwe)

- Both

Will just look at % who got their funds from a formal source irregardless of whether they got funds from an informal source.

```{r echo=FALSE}
funds_start = data %>%
  # columns with the details of this question... can select multiple
  select(all_of(level), 
         funds_start, # Personal savings (from salary or other business initiatives)
         X.25, #        Micro finance institution
         X.26, #        Banks
         X.27, #        Order finance companies
         X.28, #        Rotating and savings groups
         X.29, #        Local NGOs
         X.30, #        Loan sharks (chimbadzo)
         X.31, #        Credit unions
         X.32, #        Government assistance programs
         X.33, #        International organization through a grant
         X.34, #        Locally based Family and friends
         X.35, #        Remittances from family or friends outside Zimbabwe
         X.36, #        Fellow business colleagues
         X.37 #         Other
         ) %>%
  # section off informal, formal sources of funds
  mutate(X.27 = as.character(X.27),
         informal_start = ifelse((funds_start != "" | X.30 != "" | X.34 != "" | X.35 != ""), 1, 0),
         formal_start = ifelse((X.25 != "" | X.26 != "" | X.27 != "" | is.na(X.27) | X.28 != "" | X.29 != "" | 
                                  X.31 != "" | X.32 != "" | X.33 != "" | X.36 != ""), 1, 0),
         
         informal_funds_start = ifelse(informal_start == 1 & formal_start == 0, 1, 0),
         formal_funds_start = ifelse(formal_start == 1 & informal_start == 0, 1,0),
         both_informal_formal_funds_start = ifelse(informal_start == 1 & formal_start == 1, 1, 0),
         not_answered = ifelse(informal_start == 0 & formal_start == 0, 1, 0)
  ) %>%
  # provincial aggregated results
  group_by(across(all_of(level))) %>%
  summarise(informal_funds_start = sum(informal_funds_start, na.rm = T),
            formal_funds_start = sum(formal_funds_start, na.rm = T),
            both_informal_formal_funds_start = sum(both_informal_formal_funds_start, na.rm =T),
            no_answers_funds_start = sum(not_answered, na.rm = T),
            responses = n()) %>%
  # final figure to use in the index
  mutate(funds_start = formal_funds_start + both_informal_formal_funds_start) %>%
  # standardize as percentage of those answered
  mutate(informal_funds_start = informal_funds_start / (responses - no_answers_funds_start),
         formal_funds_start = formal_funds_start / (responses - no_answers_funds_start),
         both_informal_formal_funds_start = both_informal_formal_funds_start / (responses - no_answers_funds_start),
         funds_start_value = funds_start / (responses - no_answers_funds_start)) 

funds_start %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### funds ongoing

Where generally get funds for ongoing business ventures

Informal vs formal vs both

- Formal

- Informal

- Informal

Again proportion that get funds from formal sources

```{r echo=FALSE}
funds_ongoing = data %>%
  # columns with the details of this question... can select multiple
  select(all_of(level),
         funds_ongoing, # Personal savings (from salary or other business initiatives)
         X.45, #        Micro finance institution
         X.46, #        Banks
         X.47, #        Order finance companies
         X.48, #        Rotating and savings groups
         X.49, #        Internal Savings and Lending Group
         X.50, #        Local NGOs
         X.51, #        Loan sharks (chimbadzo)
         X.52, #        Credit unions
         X.53, #        Government of Zimbabwe
         X.54, #        Remittances from family or friends outside Zimbabwe
         X.55, #        International organization through a grant
         X.56, #        Locally based Family and friends
         X.57, #        Fellow business colleagues
         X.58, #        Other
         ) %>%
  # section off informal, formal sources of funds
  mutate(X.49 = as.character(X.49),
         informal_ongoing = ifelse((funds_ongoing != "" | X.51 != "" | X.54 != "" | X.56 != ""), 1, 0),
         formal_ongoing = ifelse((X.45 != "" | X.46 != "" | X.47 != "" | X.48 != "" | X.49 != "" | X.50 != "" | X.52 != "" | X.53 != "" | X.55 != "" | X.57 != ""), 1, 0),
         informal_funds_ongoing = ifelse(informal_ongoing == 1 & formal_ongoing == 0, 1, 0),
         formal_funds_ongoing = ifelse(formal_ongoing == 1 & informal_ongoing == 0, 1,0),
         both_informal_formal_funds_ongoing = ifelse(informal_ongoing == 1 & formal_ongoing == 1, 1, 0),
         not_answered = ifelse(informal_ongoing == 0 & formal_ongoing == 0, 1, 0)
  ) %>%
  # provincial aggregated results
  group_by(across(all_of(level))) %>%
  summarise(informal_funds_ongoing = sum(informal_funds_ongoing, na.rm = T),
            formal_funds_ongoing = sum(formal_funds_ongoing, na.rm = T),
            both_informal_formal_funds_ongoing = sum(both_informal_formal_funds_ongoing, na.rm =T),
            no_answers_funds_ongoing = sum(not_answered, na.rm = T),
            responses = n()) %>%
  # final figure to use in the index
  mutate(funds_ongoing = formal_funds_ongoing + both_informal_formal_funds_ongoing) %>%
  # standardize as percentage of those answered
  mutate(informal_funds_ongoing = informal_funds_ongoing / (responses - no_answers_funds_ongoing),
         formal_funds_ongoing = formal_funds_ongoing / (responses - no_answers_funds_ongoing),
         both_informal_formal_funds_ongoing = both_informal_formal_funds_ongoing / (responses - no_answers_funds_ongoing),
         funds_ongoing_value = funds_ongoing / (responses - no_answers_funds_ongoing)) 

funds_ongoing %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

## Registration

Nothing from this section of the survey

## Banking services

### frequency

- frequency_bank_account == "Daily" ~ 5,

- frequency_bank_account == "Several times per week" ~ 5,

- frequency_bank_account == "Once a week" ~ 5,

- frequency_bank_account == "Once per month" ~ 4,

- frequency_bank_account == "Once per 3 months" ~ 3,

- frequency_bank_account == "Once per 6 months" ~ 2,

- frequency_bank_account == "Once per annum" ~ 1,

- frequency_bank_account == "I have never used it." ~ 0

```{r echo=FALSE}
frequency_bank_account = data %>%
  select(all_of(level), 
         bank_account, frequency_bank_account) %>%
  filter(bank_account == "Yes") %>%
  mutate(frequency = case_when(
    frequency_bank_account == "Daily" ~ 5,
    frequency_bank_account == "Several times per week" ~ 5,
    frequency_bank_account == "Once a week" ~ 5,
    frequency_bank_account == "Once per month" ~ 4,
    frequency_bank_account == "Once per 3 months" ~ 3,
    frequency_bank_account == "Once per 6 months" ~ 2,
    frequency_bank_account == "Once per annum" ~ 1,
    frequency_bank_account == "I have never used it." ~ 0,
    TRUE ~ as.double(0)),
    not_answered = ifelse(frequency_bank_account == "", 1, 0)
    ) %>%
  group_by(across(all_of(level))) %>%
  summarise(frequency_bank_account = mean(frequency),
            responses = n(),
            not_answered_frequency_bank = sum(not_answered)) %>%
  mutate(frequency_bank_account_value = frequency_bank_account / 5)

frequency_bank_account %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### bank services

Number of bank services

- Short term financing (Vehicle and asset financing)

- Loans and liquidity

- Bancassurance

- Access to foreign currency

- Short term deposit accounts

- SME Advisory services

- Letters of credit

- Investor services

- Trade services

- Deposit protection

Scoring

- number_services >= 5 ~ 3,

- number_services: 2-4 ~ 2,

- number_services == 1 ~ 1

```{r echo=FALSE}
 number_bank_services = data %>%
  select(all_of(level), 
         bank_account, 
         bank_services, X.69, X.70, X.71, X.72, X.73, X.74, X.75, X.76, X.77, X.78) %>%
  filter(bank_account == "Yes") %>%
  mutate(number_services = 0,
         number_services = ifelse(bank_services != "", number_services+1, number_services), # Short term financing (Vehicle and asset financing)
         number_services= ifelse(X.69 != "", number_services+1, number_services), # Loans and liquidity
         number_services = ifelse(X.70 != "", number_services+1, number_services), # Bancassurance
         number_services = ifelse(X.71 != "", number_services+1, number_services), # Access to foreign currency
         number_services = ifelse(X.72 != "", number_services+1, number_services), # Short term deposit accounts
         number_services = ifelse(X.73 != "", number_services+1, number_services), # SME Advisory services
         number_services = ifelse(X.74 != "", number_services+1, number_services), # Letters of credit
         number_services = ifelse(X.75 != "", number_services+1, number_services), # Investor services
         number_services = ifelse(X.76 != "", number_services+1, number_services), # Trade services
         number_services = ifelse(X.77 != "", number_services+1, number_services), # Deposit protection
           # X.78 != "" ~ number_services +1, # Other 
         not_answered = ifelse(number_services == 0, 1, 0),
         number_services_score = case_when(
           number_services >= 5 ~ 3,
           number_services >= 2 ~ 2,
           number_services == 1 ~ 1,
           TRUE ~ as.double(0))
         ) %>%
  filter(not_answered != 1) %>%
  group_by(across(all_of(level))) %>%
  summarise(number_bank_services = mean(number_services_score),
            responses = n(),
            not_answered_bank_services = sum(not_answered)) %>%
  mutate(number_bank_services_value = number_bank_services / 3)
 
number_bank_services %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### successful bids on sme auction

```{r echo=FALSE}
successful_bids = data %>%
  select(all_of(level), 
         foreign_currency, sme_foreign_exchange_auction, successful_bids) %>%
  filter(foreign_currency == "Yes") %>%
  filter(sme_foreign_exchange_auction == "Yes") %>%
  mutate(not_answered = ifelse(successful_bids == "", 1, 0),
         successful_bids_logic = ifelse(successful_bids == "Yes", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(successful_bids = sum(successful_bids_logic),
            responses = n(),
            not_answered_bids = sum(not_answered)) %>%
  mutate(successful_bids_value = successful_bids / (responses - not_answered_bids))

successful_bids %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

## Loans

Survey differentiates between 12 months and the previous 4 years... so this code asks for over the last five years but takes no consideration of the age of the business... 
Will need to add that component!!!

### Loan application in the past

% applied for a loan in the past

```{r echo=FALSE}
commercial_loan_apply = data %>%
  select(all_of(level),
         commercial_loan_application, commercial_loan_application_past_logic) %>%
  mutate(not_answered = ifelse(commercial_loan_application == "", 1, 0))%>%
  group_by(province) %>%
  summarise(commercial_loan_application = sum(commercial_loan_application_past_logic, na.rm = T),
            responses = n(),
            not_answered_commercial_loan = sum(not_answered, na.rm = T)) %>%
  mutate(commercial_loan_apply_value = commercial_loan_application / (responses - not_answered_commercial_loan)) 

commercial_loan_apply %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Number loan applications in 5 years

- number_commercial_loan_applications_12months == "Never" ~ 0,

- number_commercial_loan_applications_12months == "1 to 2 times" ~ 1,

- number_commercial_loan_applications_12months == "3 to 4 times" ~  1,

- number_commercial_loan_applications_12months == "5 times or more" ~ 1,

Can discriminates against a newer business

```{r echo=FALSE}
Number_commercial_loan_application = data %>%
  select(all_of(level), 
         commercial_loan_application, number_commercial_loan_applications_12months, number_commercial_loan_applications_4years) %>%
  filter(commercial_loan_application == "Yes") %>%
  mutate(not_answered = ifelse(number_commercial_loan_applications_12months == "" &
                                 number_commercial_loan_applications_4years == "", 1, 0),
         number_loan_appication = 0,
         number_loan_appication = case_when(
           number_commercial_loan_applications_12months == "Never" ~ number_loan_appication,
           number_commercial_loan_applications_12months == "1 to 2 times" ~ number_loan_appication+1,
           number_commercial_loan_applications_12months == "3 to 4 times" ~  number_loan_appication+1,
           number_commercial_loan_applications_12months == "5 times or more" ~ number_loan_appication+1,
           TRUE ~ number_loan_appication
         ),
         number_loan_appication = case_when(
           number_commercial_loan_applications_4years == "Never" ~ number_loan_appication,
           number_commercial_loan_applications_4years == "1 to 2 times" ~ number_loan_appication+1,
           number_commercial_loan_applications_4years == "3 to 4 times" ~ number_loan_appication+1,
           number_commercial_loan_applications_4years == "5 times or more" ~ number_loan_appication+1,
           TRUE ~ number_loan_appication
         )
         ) %>%
  group_by(across(all_of(level))) %>%
  summarise(Number_commercial_loan_application = mean(number_loan_appication),
            responses = n(),
            not_answered_number_application = sum(not_answered)) %>%
  mutate(Number_commercial_loan_application_value = Number_commercial_loan_application / 2)

Number_commercial_loan_application %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Successful loan application

```{r echo=FALSE}
# 12 months
success_loan_12months = data %>%
  select(all_of(level), 
         commercial_loan_application, number_commercial_loan_applications_12months,
         success_commercial_loan_application_12months) %>%
  filter(commercial_loan_application == "Yes") %>%
  filter(number_commercial_loan_applications_12months != "Never") %>%
  mutate(not_answered = ifelse(success_commercial_loan_application_12months == "", 1, 0),
         success_logic = ifelse(success_commercial_loan_application_12months == "Yes", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(success_12months = sum(success_logic),
            responses = n(),
            not_answered_success_12months = sum(not_answered)) %>%
  mutate(success_12months = success_12months/(responses - not_answered_success_12months))
 
# 4 years 
success_loan_4years = data %>%
  select(all_of(level), 
         commercial_loan_application, number_commercial_loan_applications_4years,
         success_commercial_loan_application_4years) %>%
    filter(commercial_loan_application == "Yes") %>%
  filter(number_commercial_loan_applications_4years != "Never") %>%
  mutate(not_answered = ifelse(success_commercial_loan_application_4years == "", 1, 0),
         success_logic = ifelse(success_commercial_loan_application_4years == "Yes", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(success_4years = sum(success_logic),
            responses = n(),
            not_answered_success_4years = sum(not_answered)) %>%
  mutate(success_4years = success_4years/(responses - not_answered_success_4years))

# combine

success_loan_commercial = success_loan_12months %>%
  full_join((success_loan_4years), by = all_of(level))

success_loan_commercial$success_loan_commercial_value = rowMeans(success_loan_commercial[, c("success_12months", "success_4years")])

success_loan_commercial %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Service loan

```{r echo=FALSE}
# 12months
service_loan_12months = data %>%
  select(all_of(level), 
         commercial_loan_application, number_commercial_loan_applications_12months,
         service_commercial_loan_12months) %>%
  filter(commercial_loan_application == "Yes") %>%
  filter(number_commercial_loan_applications_12months != "Never") %>%
  mutate(not_answered = ifelse(service_commercial_loan_12months == "", 1, 0),
         service_logic = ifelse(service_commercial_loan_12months == "Yes", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(service_12months = sum(service_logic),
            responses = n(),
            not_answered_service_12months = sum(not_answered)) %>%
  mutate(service_12months = service_12months / (responses - not_answered_service_12months),
         service_12months = ifelse(responses == not_answered_service_12months, 0, service_12months))

# 4 years
service_loan_4years = data %>%
  select(all_of(level), 
         commercial_loan_application, number_commercial_loan_applications_4years,
         service_commercial_loan_4years) %>%
  filter(commercial_loan_application == "Yes") %>%
  filter(number_commercial_loan_applications_4years != "Never") %>%
  mutate(not_answered = ifelse(service_commercial_loan_4years == "", 1, 0),
         service_logic = ifelse(service_commercial_loan_4years == "Yes", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(service_4years = sum(service_logic),
            responses = n(),
            not_answered_service_4years = sum(not_answered)) %>%
  mutate(service_4years = service_4years / (responses - not_answered_service_4years),
         service_4years = ifelse(responses == not_answered_service_4years, 0, service_4years))

# combine

service_loan_commercial = service_loan_12months %>%
  full_join((service_loan_4years), by = all_of(level))

service_loan_commercial$service_loan_commercial_value = rowMeans(service_loan_commercial[, c("service_12months", "service_4years")])

service_loan_commercial %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Interest Rate

Scoring

- Interest Rate < 10 ~ 3

- Interest Rate < 50 ~ 2

- Interest Rate > 50 ~ 1

Filter out any values above 100 as not interpreted correctly.

```{r echo=FALSE}
interest_12months = data %>%
  select(all_of(level),
         number_commercial_loan_applications_12months, interest_rate_commercial_loan_12months) %>%
  filter(number_commercial_loan_applications_12months != "Never") %>%
  filter(interest_rate_commercial_loan_12months > 100) %>%
  mutate(not_answered = ifelse(is.na(interest_rate_commercial_loan_12months), 1, 0),
         interest_rate_score = case_when(
           interest_rate_commercial_loan_12months > 50 ~ 1,
           interest_rate_commercial_loan_12months > 10 ~ 2,
           interest_rate_commercial_loan_12months <= 10 ~ 3,
           TRUE ~ as.double(0)
         )) %>%
  filter(not_answered != 1) %>%
  group_by(across(all_of(level))) %>%
  summarise(interest_rate_commercial_loan_12months = mean(interest_rate_score),
            responses = n(),
            not_answered_interest_12months = sum(not_answered)) %>%
  mutate(interest_rate_commercial_loan_12months = interest_rate_commercial_loan_12months / 3)

interest_4years = data %>%
  select(all_of(level),
         number_commercial_loan_applications_4years, interest_rate_commercial_loan_4years) %>%
  filter(number_commercial_loan_applications_4years != "Never") %>%
  filter(interest_rate_commercial_loan_4years > 100) %>%
  mutate(not_answered = ifelse(is.na(interest_rate_commercial_loan_4years), 1, 0),
         interest_rate_score = case_when(
           interest_rate_commercial_loan_4years > 50 ~ 1,
           interest_rate_commercial_loan_4years > 10 ~ 2,
           interest_rate_commercial_loan_4years <= 10 ~ 3,
           TRUE ~ as.double(0)
         )) %>%
  filter(not_answered != 1) %>%
  group_by(across(all_of(level))) %>%
  summarise(interest_rate_commercial_loan_4years = mean(interest_rate_score),
            responses = n(),
            not_answered_interest_4years = sum(not_answered)) %>%
  mutate(interest_rate_commercial_loan_4years = interest_rate_commercial_loan_4years / 3)

# combine

interest_commercial = interest_12months %>%
  full_join((interest_4years), by = all_of(level))

interest_commercial$interest_commercial_value = rowMeans(interest_commercial[, c("interest_rate_commercial_loan_12months", "interest_rate_commercial_loan_4years")])

interest_commercial %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Payback period

Number of months... currently prioritises to pay back in a year... but maybe inverse is better up to a point???

- Payback > 24 ~ 1

- Payback > 12 ~ 2

- Payback <= 12 ~ 3

```{r echo=FALSE}
payback_12months = data %>%
  select(all_of(level),
         number_commercial_loan_applications_12months, payback_commercial_loan_12months_months) %>%
  filter(number_commercial_loan_applications_12months != "Never") %>%
  mutate(not_answered = ifelse(is.na(payback_commercial_loan_12months_months), 1, 0),
         payback_score = case_when(
           payback_commercial_loan_12months_months > 24 ~ 1,
           payback_commercial_loan_12months_months > 12 ~ 2,
           payback_commercial_loan_12months_months <= 12 ~ 3,
           TRUE ~ as.double(0)
         )) %>%
  filter(not_answered != 1) %>%
  group_by(across(all_of(level))) %>%
  summarise(payback_commercial_loan_12months_months = mean(payback_score),
            responses = n(),
            not_answered_12months = sum(not_answered)) %>%
  mutate(payback_commercial_loan_12months_months = payback_commercial_loan_12months_months / 3)

payback_4years = data %>%
  select(all_of(level),
         number_commercial_loan_applications_4years, payback_commercial_loan_4years_months) %>%
  filter(number_commercial_loan_applications_4years != "Never") %>%
  mutate(not_answered = ifelse(is.na(payback_commercial_loan_4years_months), 1, 0),
         payback_score = case_when(
           payback_commercial_loan_4years_months > 24 ~ 1,
           payback_commercial_loan_4years_months > 12 ~ 2,
           payback_commercial_loan_4years_months <= 12 ~ 3,
           TRUE ~ as.double(0)
         )) %>%
  filter(not_answered != 1) %>%
  group_by(across(all_of(level))) %>%
  summarise(payback_commercial_loan_4years_months = mean(payback_score),
            responses = n(),
            not_answered_4years = sum(not_answered)) %>%
  mutate(payback_commercial_loan_4years_months = payback_commercial_loan_4years_months / 3)

# combine

payback_commercial = payback_12months %>%
  full_join((payback_4years), by = all_of(level))

payback_commercial$payback_commercial_value = rowMeans(payback_commercial[, c("payback_commercial_loan_12months_months", "payback_commercial_loan_4years_months")], na.rm =T)

payback_commercial %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

## Other financial services

### Number of servies

- Short term financing (Vehicle and asset financing)

- Loans and liquidity

- Bancassurance

- Access to foreign currency

- Short term deposit accounts

- SME Advisory services

- Letters of credit

- Investor services

- Trade services

- Deposit protection

Scoring

- number_services >= 5 ~ 3,

- number_services: 2-4 ~ 2,

- number_services == 1 ~ 1

```{r echo=FALSE}
number_services_other = data %>%
  select(all_of(level),
         other_finance_institutions, 
         services_other_financial_institutions, X.88, X.89, X.90, X.91, X.92, X.93, X.94, X.95, X.96) %>%
  filter(other_finance_institutions == "Yes") %>%
  mutate(number_services = 0,
         number_services = ifelse(services_other_financial_institutions != "", number_services+1, number_services),
         number_services = ifelse(X.88 != "", number_services+1, number_services),
         number_services = ifelse(X.89 != "", number_services+1, number_services),
         number_services = ifelse(X.90 != "", number_services+1, number_services),
         number_services = ifelse(X.91 != "", number_services+1, number_services),
         number_services = ifelse(X.92 != "", number_services+1, number_services),
         number_services = ifelse(X.93 != "", number_services+1, number_services),
         number_services = ifelse(X.94 != "", number_services+1, number_services),
         number_services = ifelse(X.95 != "", number_services+1, number_services),
         number_services = ifelse(X.96 != "", number_services+1, number_services),
         not_answered = ifelse(number_services == 0, 1, 0),
         number_services_score = case_when(
           number_services >= 5 ~ 3,
           number_services >= 2 ~ 2,
           number_services == 1 ~ 1,
           TRUE ~ as.double(0)
         )) %>%
  filter(not_answered == 0) %>%
  group_by(across(all_of(level))) %>%
  summarise(number_services_other = mean(number_services_score),
            responses = n(),
            not_answered_services_other = sum(not_answered)) %>%
  mutate(number_services_other_value = number_services_other / 3)

number_services_other %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Received a loan

Those who have a relationship, did they receive a loan...

How many received a loan from a formal entity

- MFI
- Order Finance
- Money club
- Credit Union
- Fellow Business Colleagues
- Local NGO
- Government of Zimbabwe
- Intl org through a grant

Informal
- loan sharks (X.99)
- Local based family and friends (X.105)
- Remittances from family and friends outside Zimbabwe (X.106)

```{r echo=FALSE}
other_formal_loan = data %>% select(all_of(level),
                other_finance_institutions, 
                loan_other_5years, X.97, X.98, X.99, X.100, X.101, X.102, X.103, X.104, X.105, X.106, X.107, X.108) %>%
  mutate(not_answered = ifelse(
    loan_other_5years == "" & X.97 == "" & X.98 == "" & X.99 == "" & X.100 == "" & X.101 == "" & X.102 == "" & X.103 == "" & 
      X.104 == "" & X.105 == "" & X.106 == "" & X.107 == "" & X.108 == "" , 1, 0),
    formal_loan = ifelse(loan_other_5years != ""  | X.97 != "" | X.98 != "" | X.100 != "" | X.101 != "" | X.102 != "" | X.103 != "" | X.104 != "" | X.107 != "", 1, 0),
    informal_loan = ifelse(X.99 != "" | X.105 != "" | X.106 != "", 1, 0)
  ) %>%
  group_by(across(all_of(level))) %>%
  summarise(other_formal_loan = sum(formal_loan),
            informal_loan = sum(informal_loan),
            responses = n(),
            not_answered_loan_other = sum(not_answered)) %>%
  mutate(other_formal_loan_value = other_formal_loan / (responses - not_answered_loan_other))

other_formal_loan %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Service loan

Of those who received a loan from another financial institution, were they able to service it

```{r}
service_loan_other = data %>%
  select(all_of(level), 
         X.108, service_loan_other_5years) %>%
  filter(X.108 != "None of the above") %>%
  mutate(not_answered = ifelse(service_loan_other_5years == "", 1, 0),
         service_logic = ifelse(service_loan_other_5years == "Yes", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(service_loan_other = sum(service_logic),
            responses = n(),
            not_answered_loan_ther = sum(not_answered)) %>%
  mutate(service_loan_other_value = service_loan_other / (responses - not_answered_loan_ther))

service_loan_other %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Interest Rate

```{r echo=FALSE}
# clean up as characters with %

interest_rate_loan_other_5years = data %>%
  select(all_of(level),
         X.108, interest_rate_loan_other_5years) %>%
  mutate(interest_rate_loan_other_5years = gsub("%", "", interest_rate_loan_other_5years, fixed = T),
         interest_rate_loan_other_5years = as.numeric(interest_rate_loan_other_5years)) %>%
  filter(X.108 != "None of the above") %>%
  filter(interest_rate_loan_other_5years > 100) %>%
  mutate(not_answered = ifelse(is.na(interest_rate_loan_other_5years), 1, 0),
         interest_rate_score = case_when(
           interest_rate_loan_other_5years > 50 ~ 1,
           interest_rate_loan_other_5years > 10 ~ 2,
           interest_rate_loan_other_5years <= 10 ~ 3,
           TRUE ~ as.double(0)
         )) %>%
  filter(not_answered != 1) %>%
  group_by(across(all_of(level))) %>%
  summarise(interest_rate_loan_other_5years = mean(interest_rate_score),
            responses = n(),
            not_answered_interest_5years = sum(not_answered)) %>%
  mutate(interest_rate_loan_other_5years_value = interest_rate_loan_other_5years / 3)

interest_rate_loan_other_5years %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### Payback Period

```{r echo=FALSE}
payback_loan_other_5years = data %>%
  select(all_of(level),
         X.108, payback_loan_other_5years) %>%
  filter(X.108 != "None of the above") %>%
  mutate(not_answered = ifelse(is.na(payback_loan_other_5years), 1, 0),
         payback_score = case_when(
           payback_loan_other_5years > 24 ~ 1,
           payback_loan_other_5years > 12 ~ 2,
           payback_loan_other_5years <= 12 ~ 3,
           TRUE ~ as.double(0)
         )) %>%
  filter(not_answered != 1) %>%
  group_by(across(all_of(level))) %>%
  summarise(payback_loan_other_5years = mean(payback_score),
            responses = n(),
            not_answered_payback_5years = sum(not_answered)) %>%
  mutate(payback_loan_other_5years_value = payback_loan_other_5years / 3)

payback_loan_other_5years %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

## Insurance

- Non-comprehensive insurance

- Comprehensive insurance

- Staff insurance

- Product insurance

- Vehicle insurance

- Other

Of those who have insurance have comprehensive insurance, staff insurance and/or product insurance

```{r echo=FALSE}
insurance_12months = data %>%
  select(all_of(level),
         insurance_business_products, insurance_12months, X.110, X.111, X.112, X.113, X.114, X.115) %>%
  filter(insurance_business_products == "Yes") %>%
  mutate(not_answered = ifelse(insurance_12months == "" & X.110 == "" & X.111 == "" & X.112 == "" & X.113 == "" & X.114 == "" & X.115 == "", 1, 0),
         comprehensive = ifelse(X.110 != "", 1, 0),
         staff = ifelse(X.111 != "" | X.112 != "", 1, 0),
         product = ifelse(X.113 != "", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(comprehensive = sum(comprehensive),
            product = sum(product),
            staff = sum(staff),
            responses = n(),
            not_answered = sum(not_answered)) %>%
  mutate(comprehesive_12months = comprehensive / (responses - not_answered),
         product_12months = product / (responses - not_answered),
         staff_12months = staff / (responses - not_answered))

insurance_4years = data %>%
  select(all_of(level),
         insurance_business_products, insurance_4years, X.116, X.117, X.118, X.119, X.120, X.121) %>%
  filter(insurance_business_products == "Yes") %>%
  mutate(not_answered = ifelse(insurance_4years == "" & X.116 == "" & X.117 == "" & X.118 == "" & X.119 == "" & X.120 == "" & X.121 == "", 1, 0),
         comprehensive = ifelse(X.116 != "", 1, 0),
         staff = ifelse(X.117 != "" | X.118 != "", 1, 0),
         product = ifelse(X.119 != "", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(comprehensive = sum(comprehensive),
            product = sum(product),
            staff = sum(staff),
            responses = n(),
            not_answered = sum(not_answered)) %>%
  mutate(comprehesive_4years = comprehensive / (responses - not_answered),
         product_4years = product / (responses - not_answered),
         staff_4years = staff / (responses - not_answered))

# combine

insurance_5years = insurance_12months %>%
  full_join((insurance_4years), by = all_of(level))

insurance_5years$comprehensive_value = rowMeans(insurance_5years[, c("comprehesive_12months", "comprehesive_4years")])
insurance_5years$product_value = rowMeans(insurance_5years[, c("product_12months", "product_4years")])
insurance_5years$staff_value = rowMeans(insurance_5years[, c("staff_12months", "staff_4years")])

insurance_5years %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

## Pensions

Nothing in this section

## Mobile money

### frequency

- frequency_mobile_money == "Everyday" ~ 5,

- frequency_mobile_money == "Two to 3 times per week" ~ 5,

- frequency_mobile_money == "Once a week" ~ 4,

- frequency_mobile_money == "Once per month" ~ 3,

- frequency_mobile_money == "Once every 3 months" ~ 3,

- frequency_mobile_money == "Once every 6 months" ~ 2,

- frequency_mobile_money == "Once per annum" ~ 1,

- frequency_mobile_money == "Never" ~ 0,

```{r echo=FALSE}
frequency_mobile_money = data %>%
  select(all_of(level), 
         mobile_money_account, frequency_mobile_money) %>%
  filter(mobile_money_account == "Yes") %>%
  mutate(frequency = case_when(
    frequency_mobile_money == "Everyday" ~ 5,
    frequency_mobile_money == "Two to 3 times per week" ~ 5,
    frequency_mobile_money == "Once a week" ~ 4,
    frequency_mobile_money == "Once per month" ~ 3,
    frequency_mobile_money == "Once every 3 months" ~ 3,
    frequency_mobile_money == "Once every 6 months" ~ 2,
    frequency_mobile_money == "Once per annum" ~ 1,
    frequency_mobile_money == "Never" ~ 0,
    TRUE ~ as.double(0)),
    not_answered = ifelse(frequency_mobile_money == "", 1, 0)
    ) %>%
  group_by(across(all_of(level))) %>%
  summarise(frequency_mobile_money = mean(frequency),
            responses = n(),
            not_answered_frequency_bank = sum(not_answered)) %>%
  mutate(frequency_mobile_money_value = frequency_mobile_money / 5)

frequency_mobile_money %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

### loan through MM

of those who have a mobile money account, have received a loan

```{r echo=FALSE}
loan_mm = data %>%
  select(all_of(level), mobile_money_account, loan_mobile_platform, loan_MM_logic) %>%
  filter(mobile_money_account == "Yes") %>%
  mutate(not_answered = ifelse(loan_mobile_platform == "", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(loan_MM = sum(loan_MM_logic),
            responses = n(),
            not_answered_loan_MM = sum(not_answered)) %>%
  mutate(loan_mm_value = loan_MM / (responses - not_answered_loan_MM))

loan_mm %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

## Investments

```{r echo=FALSE}
investments = data %>%
  select(all_of(level), 
         investments, investments_logic) %>%
  mutate(not_answered = ifelse(investments == "", 1, 0)) %>%
  group_by(across(all_of(level))) %>%
  summarise(investments = sum(investments_logic),
            responses = n(),
            not_answered_invest = sum(not_answered)) %>%
  mutate(investments_value = investments / (responses - not_answered_invest))

investments %>%
  bind_rows(summarise_all(., ~if(is.numeric(.)) sum(.) else "total")) %>%
  kable() %>%
  kable_styling()
```

## Access to Information

No information from the survey

## Final Table

```{r echo=FALSE}
# 
usage_critera = data %>%
  group_by(across(all_of(level))) %>%
  summarise(n=n()) %>%
  full_join(y = (funds_start %>% select(all_of(level), funds_start_value)), by = all_of(level)) %>%
  full_join(y = (funds_ongoing %>% select(all_of(level), funds_ongoing_value)), by = all_of(level)) %>%
  full_join(y = (frequency_bank_account %>% select(all_of(level), frequency_bank_account_value)), by = all_of(level)) %>%
  full_join(y = (number_bank_services %>% select(all_of(level), number_bank_services_value)), by = all_of(level)) %>%
  full_join(y = (successful_bids %>% select(all_of(level), successful_bids_value)), by = all_of(level)) %>%
  full_join(y = (commercial_loan_apply %>% select(all_of(level), commercial_loan_apply_value)), by = all_of(level)) %>%
  full_join(y = (Number_commercial_loan_application %>% select(all_of(level), Number_commercial_loan_application_value)), by = all_of(level)) %>%
  full_join(y = (success_loan_commercial %>% select(all_of(level), success_loan_commercial_value)), by = all_of(level)) %>%
  full_join(y = (service_loan_commercial %>% select(all_of(level), service_loan_commercial_value)), by = all_of(level)) %>%
  full_join(y = (interest_commercial %>% select(all_of(level), interest_commercial_value)), by = all_of(level)) %>%
  full_join(y = (payback_commercial %>% select(all_of(level), payback_commercial_value)), by = all_of(level)) %>%
  full_join(y = (number_services_other %>% select(all_of(level), number_services_other_value)), by = all_of(level)) %>%
  full_join(y = (other_formal_loan %>% select(all_of(level), other_formal_loan_value)), by = all_of(level)) %>%
  full_join(y = (service_loan_other %>% select(all_of(level), service_loan_other_value)), by = all_of(level)) %>%
  full_join(y = (interest_rate_loan_other_5years %>% select(all_of(level), interest_rate_loan_other_5years_value)), by = all_of(level)) %>%
  full_join(y = (payback_loan_other_5years %>% select(all_of(level), payback_loan_other_5years_value)), by = all_of(level)) %>%
  full_join(y = (insurance_5years %>% select(all_of(level), comprehensive_value, product_value, staff_value)), by = all_of(level)) %>%
  full_join(y = (frequency_mobile_money %>% select(all_of(level), frequency_mobile_money_value)), by = all_of(level)) %>%
  full_join(y = (loan_mm %>% select(all_of(level), loan_mm_value)), by = all_of(level)) %>%
  full_join(y = (investments %>% select(all_of(level), investments_value)), by = all_of(level)) %>%

  mutate_if(is.numeric, replace_na, 0.5)



usage_critera$usage_score = rowSums(usage_critera[, c(
  all_of(criteria))])

usage_critera$usage_normalise = (usage_critera$usage_score / ncriteria)

usage_critera$usage_percentage = round((usage_critera$usage_normalise * 100),2)

usage_critera %>%
  kable() %>%
  kable_styling()
```

```{r}
write.csv(usage_critera, file = "~/SIVIOgit/usage_criteria.csv")
```


